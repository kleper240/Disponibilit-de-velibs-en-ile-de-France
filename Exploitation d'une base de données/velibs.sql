-- phpMyAdmin SQL Dump
-- version 5.1.1
-- https://www.phpmyadmin.net/
--
-- Hôte : 127.0.0.1:3306
-- Généré le : lun. 05 juin 2023 à 12:41
-- Version du serveur : 5.7.36
-- Version de PHP : 7.4.26

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- Base de données : `velibs`
--

-- --------------------------------------------------------

--
-- Structure de la table `history_change`
--

DROP TABLE IF EXISTS `history_change`;
CREATE TABLE IF NOT EXISTS `history_change` (
  `id` int(64) NOT NULL AUTO_INCREMENT,
  `table_name` text,
  `action` text,
  `action_date` datetime DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1;

-- --------------------------------------------------------

--
-- Structure de la table `station_information_dynamique`
--

DROP TABLE IF EXISTS `station_information_dynamique`;
CREATE TABLE IF NOT EXISTS `station_information_dynamique` (
  `stationcode` text,
  `is_installed` text,
  `numdocksavailable` int(64) DEFAULT NULL,
  `numbikesavailable` int(64) DEFAULT NULL,
  `mechanical` int(64) DEFAULT NULL,
  `ebike` int(64) DEFAULT NULL,
  `nom_arrondissement_communes` text,
  `Date` datetime DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1;

--
-- Déclencheurs `station_information_dynamique`
--
DROP TRIGGER IF EXISTS `check_is_installed`;
DELIMITER $$
CREATE TRIGGER `check_is_installed` BEFORE INSERT ON `station_information_dynamique` FOR EACH ROW BEGIN
    IF NEW.is_installed = 'OUI' THEN
        SET NEW.is_installed = '1';
    ELSE
        SET NEW.is_installed = '0';
    END IF;
END
$$
DELIMITER ;
DROP TRIGGER IF EXISTS `log_history_change`;
DELIMITER $$
CREATE TRIGGER `log_history_change` AFTER INSERT ON `station_information_dynamique` FOR EACH ROW BEGIN
    INSERT INTO history_change (table_name, action, action_date) VALUES ('station_information_dynamique', 'INSERT', NOW());
END
$$
DELIMITER ;
DROP TRIGGER IF EXISTS `log_history_change_after_delete`;
DELIMITER $$
CREATE TRIGGER `log_history_change_after_delete` AFTER DELETE ON `station_information_dynamique` FOR EACH ROW BEGIN
        INSERT INTO history_change (table_name, action, action_date) VALUES ('station_information_dynamique', 'DROP', NOW());
    END
$$
DELIMITER ;
DROP TRIGGER IF EXISTS `log_history_change_after_update`;
DELIMITER $$
CREATE TRIGGER `log_history_change_after_update` AFTER UPDATE ON `station_information_dynamique` FOR EACH ROW BEGIN
        INSERT INTO history_change (table_name, action, action_date) VALUES ('station_information_dynamique', 'UPDATE', NOW());
    END
$$
DELIMITER ;

-- --------------------------------------------------------

--
-- Structure de la table `station_information_static`
--

DROP TABLE IF EXISTS `station_information_static`;
CREATE TABLE IF NOT EXISTS `station_information_static` (
  `stationcode` text,
  `name` text,
  `capacity` int(11) DEFAULT NULL,
  `longitude` double DEFAULT NULL,
  `latitude` double DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1;

-- --------------------------------------------------------

--
-- Doublure de structure pour la vue `stats_sur_periode_donnee`
-- (Voir ci-dessous la vue réelle)
--
DROP VIEW IF EXISTS `stats_sur_periode_donnee`;
CREATE TABLE IF NOT EXISTS `stats_sur_periode_donnee` (
`stationcode` text
,`name` text
,`capacity` int(11)
,`longitude` double
,`latitude` double
,`numdocksavailable` int(64)
,`numbikesavailable` int(64)
,`mechanical` int(64)
,`ebike` int(64)
,`nom_arrondissement_communes` text
,`date` datetime
);

-- --------------------------------------------------------

--
-- Structure de la table `teste`
--

DROP TABLE IF EXISTS `teste`;
CREATE TABLE IF NOT EXISTS `teste` (
  `stationcode` text,
  `is_installed` text,
  `numdocksavailable` int(64) DEFAULT NULL,
  `numbikesavailable` int(64) DEFAULT NULL,
  `mechanical` int(64) DEFAULT NULL,
  `ebike` int(64) DEFAULT NULL,
  `nom_arrondissement_communes` text,
  `Date` datetime DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1;

-- --------------------------------------------------------

--
-- Structure de la vue `stats_sur_periode_donnee`
--
DROP TABLE IF EXISTS `stats_sur_periode_donnee`;

DROP VIEW IF EXISTS `stats_sur_periode_donnee`;
CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `stats_sur_periode_donnee`  AS SELECT `stc`.`stationcode` AS `stationcode`, `stc`.`name` AS `name`, `stc`.`capacity` AS `capacity`, `stc`.`longitude` AS `longitude`, `stc`.`latitude` AS `latitude`, `std`.`numdocksavailable` AS `numdocksavailable`, `std`.`numbikesavailable` AS `numbikesavailable`, `std`.`mechanical` AS `mechanical`, `std`.`ebike` AS `ebike`, `std`.`nom_arrondissement_communes` AS `nom_arrondissement_communes`, `std`.`Date` AS `date` FROM (`station_information_dynamique` `std` join `station_information_static` `stc` on((`std`.`stationcode` = `stc`.`stationcode`))) ;
COMMIT;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
